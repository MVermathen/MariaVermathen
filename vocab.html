<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saved Vocabulary</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="sotho-page">

<h1>Saved Vocabulary</h1>
<p><a href="sotho.html">← Back to phrase builder</a></p>

<div id="vocabList"></div>

<!--SCRIPT POUCH DB-->
<script src="https://cdn.jsdelivr.net/npm/pouchdb@9.0.0/dist/pouchdb.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const container = document.getElementById("vocabList");
  const db = new PouchDB("sesotho-vocab");
  const vocabDocId = "vocab";

  async function loadVocab() {
    try {
      const doc = await db.get(vocabDocId);
      console.log("Loaded vocab:", doc.data);
      renderVocab(doc.data);
    } catch (err) {
      if (err.status === 404) {
        container.textContent = "No vocab saved yet.";
      } else {
        console.error(err);
        container.textContent = "Error loading vocab.";
      }
    }
  }

  function renderVocab(vocab) {
    container.innerHTML = "";

    for (const type in vocab) {
      if (!Array.isArray(vocab[type]) || vocab[type].length === 0) continue;

      const h2 = document.createElement("h2");
      h2.textContent = type;
      container.appendChild(h2);

      vocab[type].forEach((item, index) => {
        const div = document.createElement("div");
        div.className = `vocab-item ${type}`;

        div.innerHTML = `
        <span>${formatItem(item)}</span>
        <button data-type="${type}" data-index="${index}" class="edit-btn">Edit</button>
        <button data-type="${type}" data-index="${index}" class="delete-btn">Delete</button>
        `;

        container.appendChild(div);
      });
    }
  }

  function formatItem(item) {
    if (item.stho_singular) {
      return `${item.stho_singular} / ${item.stho_plural} — ${item.en_singular} / ${item.en_plural}`;
    }

    if (item.stho_present) {
    return `${item.stho_present} / ${item.stho_past} — ${item.en_present} / ${item.en_past}`;
  }

  return `${item.stho} — ${item.en}`;
}

  container.addEventListener("click", async (e) => {
  if (e.target.classList.contains("delete-btn")) {
    const type = e.target.dataset.type;
    const index = Number(e.target.dataset.index);

    if (!confirm("Delete this word?")) return;

    const doc = await db.get(vocabDocId);
    doc.data[type].splice(index, 1);
    await db.put(doc);

    loadVocab();
  }

  if (e.target.classList.contains("edit-btn")) {
    const type = e.target.dataset.type;
    const index = Number(e.target.dataset.index);

    const doc = await db.get(vocabDocId);
    const item = doc.data[type][index];

    const updated = prompt(
      "Edit as JSON:",
      JSON.stringify(item, null, 2)
    );

     if (!updated) return;

    try {
      doc.data[type][index] = JSON.parse(updated);
      await db.put(doc);
      loadVocab();
    } catch {
      alert("Invalid JSON.");
    }
  }
  });

  loadVocab();
});
</script>

<!--SCRIPT LOCAL STORAGE-->
<!--
<script>
const container = document.getElementById("vocabList");
let vocab = JSON.parse(localStorage.getItem("sothoVocab"));

if (!vocab) {
  container.textContent = "No vocab saved yet.";
} else {
  renderVocab();
}

function renderVocab() {
  container.innerHTML = "";

  for (const type in vocab) {
    if (vocab[type].length === 0) continue;

    const h2 = document.createElement("h2");
    h2.textContent = type;
    container.appendChild(h2);

    vocab[type].forEach((item, index) => {
      const div = document.createElement("div");
      div.className = `vocab-item ${type}`;

      div.innerHTML = `
        <span>${formatItem(item)}</span>
        <button onclick="editItem('${type}', ${index})">Edit</button>
        <button onclick="deleteItem('${type}', ${index})">Delete</button>
      `;

      container.appendChild(div);
    });
  }
}

function formatItem(item) {
  if (item.stho_singular) {
    return `${item.stho_singular} / ${item.stho_plural} — ${item.en_singular} / ${item.en_plural}`;
  }

  if (item.stho_present) {
    return `${item.stho_present} / ${item.stho_past} — ${item.en_present} / ${item.en_past}`;
  }

  return `${item.stho} — ${item.en}`;
}

function deleteItem(type, index) {
  if (!confirm("Delete this word?")) return;

  vocab[type].splice(index, 1);
  localStorage.setItem("sothoVocab", JSON.stringify(vocab));
  renderVocab();
}

function editItem(type, index) {
  const item = vocab[type][index];

  const updated = prompt(
    "Edit (use same format):",
    JSON.stringify(item)
  );

  if (!updated) return;

  try {
    vocab[type][index] = JSON.parse(updated);
    localStorage.setItem("sothoVocab", JSON.stringify(vocab));
    renderVocab();
  } catch {
    alert("Invalid format.");
  }
}
</script>
-->

</body>
</html>